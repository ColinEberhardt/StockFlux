"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){angular.module("OpenFinD3FC",["ngAnimate","openfin.main","openfin.showcase","openfin.toolbar","openfin.icon","openfin.search","openfin.favourites","openfin.sidebar","openfin.filters","openfin.star","openfin.tearout","openfin.minichart","openfin.scroll"]),angular.module("openfin.main",[]),angular.module("openfin.showcase",["openfin.selection","openfin.quandl"]),angular.module("openfin.toolbar",["openfin.currentWindow"]),angular.module("openfin.icon",[]),angular.module("openfin.search",["openfin.quandl","openfin.selection","openfin.currentWindow"]),angular.module("openfin.favourites",["openfin.quandl","openfin.selection","openfin.currentWindow"]),angular.module("openfin.sidebar",[]),angular.module("openfin.filters",[]),angular.module("openfin.star",["openfin.selection"]),angular.module("openfin.tearout",["openfin.geometry","openfin.hover","openfin.currentWindow"]),angular.module("openfin.minichart",["openfin.quandl"]),angular.module("openfin.store",[]),angular.module("openfin.currentWindow",[]),angular.module("openfin.scroll",[])}(),function(){var a=function(){function a(b){_classCallCheck(this,a),this.$scope=b,this.setup()}return _createClass(a,[{key:"setup",value:function(){function a(a){return arguments.length?void(d[c+e]=a):d[c+e]}function b(a){return arguments.length?void(d[c+f]=a):d[c+f]}var c=this.$scope.name,d={},e="_active",f="_hovered";d[c+e]=!1,d[c+f]=!1,this.urls={inactive:c,hover:c+"_hover",active:c+"_active"},this.icon={active:a,hovered:b}}},{key:"enter",value:function(){this.icon.hovered(!0)}},{key:"leave",value:function(){this.icon.hovered(!1),this.icon.active(!1)}},{key:"url",value:function(){return this.icon.active()?this.urls.active:this.icon.hovered()?this.urls.hover:this.urls.inactive}},{key:"mouseDown",value:function(a,b){0===a.button&&this.icon.active(!0)}},{key:"click",value:function(a,b){0===a.button&&(this.icon.active(!0),this.$scope.iconClick(),this.icon.active(!1),this.icon.hovered(!1))}}]),a}();a.$inject=["$scope"],angular.module("openfin.icon").controller("IconCtrl",a)}(),function(){angular.module("openfin.icon").directive("icon",[function(){return{restrict:"E",templateUrl:"icon/icon.html",scope:{name:"@",iconClick:"&"},controller:"IconCtrl",controllerAs:"iconCtrl"}}])}(),function(){var a=function(){function a(){_classCallCheck(this,a),this.store=null}return _createClass(a,[{key:"isCompact",value:function(){return!this.store&&window.storeService&&(this.store=window.storeService.open(window.name)),this.store&&this.store.isCompact()}}]),a}();a.$inject=[],angular.module("openfin.main").controller("MainCtrl",a)}(),function(){angular.module("openfin.main").directive("main",[function(){return{restrict:"E",templateUrl:"main/main.html",controller:"MainCtrl",controllerAs:"mainCtrl"}}])}(),function(a){angular.module("openfin.currentWindow").factory("currentWindowService",["$rootScope",function(b){function c(){return a.desktop.Window.getCurrent()}function d(b){a.desktop.main(b)}return window.addEventListener("updateFavourites",function(a){b.$broadcast("updateFavourites",a.stock)}),{getCurrentWindow:c,ready:d}}])}(fin),function(){function a(){return moment().subtract(28,"days")}function b(a,b,c){var d=a.dataset_code,e={name:a.name,code:d,favourite:!1,query:b};c(e)}function c(b){for(var c=b.datasets,d=[],e=0,f=c.length;f>e;e++)moment(c[e].newest_available_date)>a()&&d.push(c[e]);return{datasets:d}}function d(a){var b=a.dataset,c=b.data,d=[],f=0,g=c.length;for(f;g>f;f++)d.push(e(c[f]));a.stockData={startDate:b.start_date,endDate:b.end_date,data:d}}function e(a){return{date:a[h],open:a[i],high:a[j],low:a[k],close:a[l],volume:a[m]}}var f="kM9Z9aEULVDD7svZ4A8B",g="api_key="+f,h=0,i=1,j=2,k=3,l=4,m=5,n="https://www.quandl.com/api/v3/",o="datasets/WIKI/",p=function(){function e(a){_classCallCheck(this,e),this.$resource=a}return _createClass(e,[{key:"search",value:function(a,c,d){this.stockSearch().get({query:a},function(e){e.datasets.map(function(d){b(d,a,c)}),0===e.datasets.length&&d()})}},{key:"getMeta",value:function(a,c){this.stockMetadata().get({stock_code:a},function(d){b(d.dataset,a,c)})}},{key:"stockData",value:function(){var b,c=a().format("YYYY-MM-DD");return this.$resource(n+o+":code.json?"+g+"&start_date="+c,{},{get:{method:"GET",transformResponse:function(a,c){return b=angular.fromJson(a),d(b),b},cache:!0}})}},{key:"getData",value:function(a,b){return this.stockData().get({code:a},function(c){var d={name:c.dataset.name,code:a,data:c.stockData.data};b(d)})}},{key:"stockMetadata",value:function(){return this.$resource(n+o+":stock_code/metadata.json?"+g,{},{get:{method:"GET",cache:!0}})}},{key:"stockSearch",value:function(){return this.$resource(n+"datasets.json?"+g+"&query=:query&database_code=WIKI",{},{get:{method:"GET",cache:!0,transformResponse:function(a,b){var d=angular.fromJson(a);return c(d)}}})}},{key:"apiKey",value:function(){return f}}]),e}();p.$inject=["$resource"],angular.module("openfin.quandl",["ngResource"]).service("quandlService",p)}(),function(){var a={code:"",name:""},b=function(){function b(){_classCallCheck(this,b),this._stock=a}return _createClass(b,[{key:"select",value:function(a){this._stock=a}},{key:"selectedStock",value:function(){return this._stock}},{key:"deselect",value:function(){this._stock=a}},{key:"hasSelection",value:function(){return this._stock!==a}}]),b}();b.$inject=[],angular.module("openfin.selection",[]).service("selectionService",b)}(),function(){var a=function(){function a(b){_classCallCheck(this,a),this.selectionService=b}return _createClass(a,[{key:"selectionCode",value:function(){return this.selectionService.selectedStock().code}},{key:"selectionName",value:function(){return this.selectionService.selectedStock().name}},{key:"hasSelection",value:function(){return this.selectionService.hasSelection()}}]),a}();a.$inject=["selectionService"],angular.module("openfin.showcase",["openfin.selection","openfin.quandl"]).controller("ShowcaseCtrl",a)}(),function(a){angular.module("openfin.showcase").directive("showcase",["quandlService",function(b){return{restrict:"E",templateUrl:"showcase/showcase.html",scope:{selection:"&"},link:function(c,d){var e=a.app().quandlApiKey(b.apiKey()),f=!0;c.$watch("selection()",function(a,b){""!==a&&(f&&(f=!1,e.run(d[0].children[0])),a!==b&&e.changeQuandlProduct(a))})}}}])}(bitflux),function(){var a={up:"arrow_up",down:"arrow_down"},b=function(){function b(a,c,d,e,f){_classCallCheck(this,b),this.currentWindowService=a,this.quandlService=c,this.selectionService=d,this.$scope=e,this.$timeout=f,this.store=null,this.stocks=[],this.update(),this._watch()}return _createClass(b,[{key:"icon",value:function(b){return b.delta<0?a.down:a.up}},{key:"selection",value:function(){return this.selectionService.selectedStock().code}},{key:"select",value:function(a){this.selectionService.select(a)}},{key:"noFavourites",value:function(){return 0===this.stocks.length}},{key:"single",value:function(){return 1===this.stocks.length?"single":""}},{key:"update",value:function(a){var b=this;this.currentWindowService.ready(function(){b.store||(b.store=window.storeService.open(window.name)),b.favourites=b.store.get();var c,d,e;for(c=0,d=b.stocks.length;d>c;c++){var f=b.stocks[c];f.index=b.stockSortFunction(f)}var g=[];for(c=0,d=b.stocks.length;d>c;c++)-1===b.favourites.indexOf(b.stocks[c].code)&&g.push(c);for(c=g.length-1,e=0;c>=e;c--)b.stocks.splice(g[c],1);var h=b.selectionService.selectedStock();if(a)if(0===b.stocks.length)a.favourite?b.selectionService.select(a):h.code===a.code&&b.selectionService.deselect();else if(h.code===a.code&&(!a.favourite||-1===b.favourites.indexOf(h.code))&&b.stocks.length>0){var i=b.stocks.filter(function(a){return a.code===b.favourites[0]})[0];b.selectionService.select(i)}b.favourites.map(function(a){-1===b.stocks.map(function(a){return a.code}).indexOf(a)&&b.quandlService.getData(a,function(c){if(-1===b.stocks.map(function(a){return a.code}).indexOf(a)){var d,e,f,g=c.data[0];g&&(d=g.close,e=g.close-g.open,f=e/g.open*100,b.stocks.push({name:c.name,code:c.code,price:d,delta:e,percentage:Math.abs(f),favourite:!0,index:b.stockSortFunction(c)}))}})})})}},{key:"stockSortFunction",value:function(a){return this.favourites.indexOf(a.code)}},{key:"_watch",value:function(){var a=this;this.$scope.$on("updateFavourites",function(b,c){a.$timeout(function(){a.update(c)})})}}]),b}();b.$inject=["currentWindowService","quandlService","selectionService","$scope","$timeout"],angular.module("openfin.favourites").controller("FavouritesCtrl",b)}(),function(){angular.module("openfin.favourites").directive("favourite",[function(){return{restrict:"E",templateUrl:"sidebars/favourites/favourite.html",scope:{stock:"=",selection:"&",select:"&",icon:"&",single:"&"}}}])}(),function(){var a=function d(a,b){_classCallCheck(this,d),this.x=a||0,this.y=b||0},b=function(){function b(c){_classCallCheck(this,b),this.origin=new a(c.left,c.top),this.extent=new a(c.width,c.height)}return _createClass(b,[{key:"top",value:function(){return this.origin.y}},{key:"left",value:function(){return this.origin.x}},{key:"bottom",value:function(){return this.top()+this.extent.y}},{key:"right",value:function(){return this.left()+this.extent.x}},{key:"corner",value:function(){return new a(this.right(),this.bottom())}},{key:"intersects",value:function(a){var b=a.origin,c=a.corner();return c.x>this.origin.x&&c.y>this.origin.y&&b.x<this.corner().x&&b.y<this.corner().y}}]),b}(),c=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"rectangle",value:function(a){return new b(a)}},{key:"getWindowPosition",value:function(a){return{height:a.outerHeight,width:a.outerWidth,top:a.screenY,left:a.screenX}}},{key:"elementScreenPosition",value:function(a,b){var c=b.getBoundingClientRect();return{height:c.height,width:c.width,top:a.top+c.top,left:a.left+c.left}}},{key:"windowsIntersect",value:function(a,b){var c=a.getNativeWindow(),d=this.rectangle(this.getWindowPosition(c)),e=this.rectangle(this.getWindowPosition(b));return d.intersects(e)}}]),a}();angular.module("openfin.geometry",[]).service("geometryService",c)}(),function(){var a=function(){function a(b){_classCallCheck(this,a),this.$rootScope=b,this.hoverTargets=[]}return _createClass(a,[{key:"get",value:function(){return this.hoverTargets}},{key:"add",value:function(a,b){var c={hoverArea:a,code:b};-1===this.hoverTargets.indexOf(c)&&this.hoverTargets.push(c)}},{key:"remove",value:function(a){for(var b=0,c=this.hoverTargets.length;c>b;b++)if(this.hoverTargets[b].code===a){this.hoverTargets.splice(b,1);break}}}]),a}();a.$inject=["$rootScope"],angular.module("openfin.hover",[]).service("hoverService",a)}(),function(){var a=function(){function a(b,c){_classCallCheck(this,a),this.quandlService=b,this.$timeout=c}return _createClass(a,[{key:"renderChart",value:function(a){var b=this;this.$timeout(function(){b.quandlService.getData(a.code,function(a){var b=fc.util.innerDimensions(document.getElementById(a.code+"chart")),c=b.width,d=b.height,e=a.data;e=e.map(function(a){var b=moment(a.date);return a.date=b.toDate(),a});var f=d3.select("#"+a.code+"chart").insert("svg","div").attr("width",c).attr("height",d),g=fc.scale.dateTime().domain(fc.util.extent().fields("date")(e)).discontinuityProvider(fc.scale.discontinuity.skipWeekends()).range([0,c]),h=fc.util.extent().fields(["close"])(e),i=d3.scale.linear().domain(h).range([d,0]).nice(),j=fc.series.area().y0Value(function(a){return h[0]}).y1Value(function(a){return a.close}).decorate(function(b){b.attr("fill","url(#"+a.code+"-minichart-gradient)")}),k=fc.series.line(),l=[].concat(e.slice(0)[0]),m=fc.series.point(),n=fc.series.multi().series([j,k,m]).xScale(g).yScale(i).mapping(function(a){switch(a){case m:return l;default:return e}});f.append("g").datum(e).call(n)})})}}]),a}();a.$inject=["quandlService","$timeout"],angular.module("openfin.minichart",["openfin.quandl"]).controller("MinichartCtrl",a)}(),function(){angular.module("openfin.minichart").directive("minichart",[function(){return{restrict:"E",templateUrl:"sidebars/favourites/minichart/minichart.html",scope:{renderChart:"&",stock:"="}}}])}(),function(a){angular.module("openfin.tearout").directive("tearable",["geometryService","hoverService","currentWindowService",function(b,c,d){return{restrict:"C",link:function(d,e,f){function g(){function e(e){for(var f=c.get(),g=0,h=f.length;h>g;g++){var j=b.rectangle(b.elementScreenPosition(b.getWindowPosition(a),f[g].hoverArea)),k=e.intersects(j);if(k){i||(i=a.storeService.open(a.name)),i.reorder(d.stock.code,f[g].code);break}}}var f,g=k.parentNode,o=g.parentNode,p=o.getElementsByClassName("hover-area")[0],q={x:0,y:0},r=!1,s=!0,t={};c.add(p,d.stock.code),t.setOffset=function(a,b){return q.x=a,q.y=b,t},t.setCurrentlyDragging=function(a){return r=a,t},t.moveTearoutWindow=function(a,b){var c=5,d=5,e=16;return n.moveTo(a-l+(e-q.x+d),b-(c+q.y)),t},t.displayTearoutWindow=function(){return n.show(),n.setAsForeground(),t},t.appendToOpenfinWindow=function(a,b){return b.contentWindow.document.body.appendChild(a),t},t.returnFromTearout=function(){g.appendChild(k),n.hide()},t.clearIncomingTearoutWindow=function(){return n.getNativeWindow().document.body=n.getNativeWindow().document.createElement("body"),t},t.handleMouseDown=function(a){return 0!==a.button?!1:j.classList.contains("single")?!1:(f=m.registerDrag(n),void t.setCurrentlyDragging(!0).setOffset(a.offsetX,a.offsetY).moveTearoutWindow(a.screenX,a.screenY).clearIncomingTearoutWindow().appendToOpenfinWindow(k,n).displayTearoutWindow())},t.handleMouseMove=function(a){r&&t.moveTearoutWindow(a.screenX,a.screenY)},t.handleMouseUp=function(c){return 0!==c.button?!1:void(r&&(t.setCurrentlyDragging(!1),s?t.returnFromTearout():(i||(i=a.storeService.open(a.name)),i.remove(d.stock),f.overAnotherInstance(function(e){if(e)f.moveToOtherInstance(d.stock),f=null;else{var j=b.getWindowPosition(a);m.createMainWindow(null,i.isCompact(),function(b){b.resizeTo(j.width,j.height,"top-left"),b.moveTo(c.screenX,c.screenY),a.storeService.open(b.name).add(d.stock)})}o.removeChild(p),o.removeChild(g),h(),n.close()}))))},n.addEventListener("bounds-changing",function(){var c=n.getNativeWindow(),d=b.rectangle(b.getWindowPosition(c));s=b.windowsIntersect(n,a),s&&e(d)}),j.addEventListener("mousedown",t.handleMouseDown),document.addEventListener("mousemove",t.handleMouseMove,!0),document.addEventListener("mouseup",t.handleMouseUp,!0)}function h(){c.remove(d.stock.code)}var i,j=e[0],k=j.parentNode.parentNode,l=k.clientWidth||230,m=(k.clientHeight||100,a.windowService),n=m.createTearoutWindow(a.name);d.$on("$destroy",function(){h()}),g()}}}])}(window),function(){angular.module("openfin.filters").filter("truncate",function(){return function(a){if(a){var b=a.indexOf("(");return a.slice(0,b-1)}}})}(),function(){angular.module("openfin.scroll").directive("customScrollbar",[function(){return{restrict:"C",link:function(a,b){var c="scrollPadding";b.mCustomScrollbar({callbacks:{onOverflowY:function(){b.addClass(c)},onOverflowYNone:function(){b.removeClass(c)}}})}}}])}(),function(){var a=function(){function a(b,c,d,e){_classCallCheck(this,a),this.$scope=b,this.quandlService=c,this.selectionService=d,this.currentWindowService=e,this.store=null,this.query="",this.noResults=!1,this.stocks=[],this._watch()}return _createClass(a,[{key:"selection",value:function(){return this.selectionService.selectedStock().code}},{key:"select",value:function(a){this.selectionService.select(a)}},{key:"onSearchKeyDown",value:function(a){38===a.keyCode?this.changePointer(-1):40===a.keyCode?this.changePointer(1):27===a.keyCode&&this.$scope.sidebarCtrl.favouritesClick()}},{key:"changePointer",value:function(a){var b=this.stocks.map(function(a){return a.code}).indexOf(this.selection()),c=b+a;c=Math.max(0,Math.min(c,this.stocks.length-1)),this.stocks.length>0&&this.select(this.stocks[c])}},{key:"submit",value:function(){var a=this;this.stocks=[],this.noResults=!1,this.currentWindowService.ready(function(){a.store||(a.store=window.storeService.open(window.name));var b=a.store.get();if(a.query){var c=b.length;a.quandlService.search(a.query,function(d){var e;if(a.stocks=a.stocks.filter(function(b,c){return b.query===a.query}),d.query===a.query){a.noResults=!1;var f=!1;for(e=0;c>e;e++)d.code===b[e]&&(d.favourite=!0,a.stocks.unshift(d),f=!0);f||a.stocks.push(d)}},function(){return a.noResults=!0})}else b.map(function(b){a.quandlService.getMeta(b,function(b){b.favourite=!0,a.stocks.push(b)})})})}},{key:"_watch",value:function(){var a=this;this.$scope.$watch(function(){return a.query},function(){a.submit()}),this.$scope.$on("updateFavourites",function(b,c){if(c){var d=a.stocks.map(function(a){return a.code}).indexOf(c.code);d>-1&&(a.query?a.stocks[d].favourite=c.favourite:a.stocks.splice(d,1))}})}}]),a}();a.$inject=["$scope","quandlService","selectionService","currentWindowService"],angular.module("openfin.search").controller("SearchCtrl",a)}(),function(){angular.module("openfin.search").directive("search",[function(){return{restrict:"E",templateUrl:"sidebars/search/search.html",controller:"SearchCtrl",controllerAs:"searchCtrl"}}])}(),function(){var a={expanded:"expanded",contracted:"contracted"},b=function(){function b(){_classCallCheck(this,b),this._favouritesClass=a.expanded,this._searchClass=a.contracted,this._showSearches=!1,this._showFavourites=!0,this._searchSmall=!0}return _createClass(b,[{key:"searchClass",value:function(){return this._searchClass}},{key:"favouritesClass",value:function(){return this._favouritesClass}},{key:"showSearches",value:function(){return this._showSearches}},{key:"showFavourites",value:function(){return this._showFavourites}},{key:"searchClick",value:function(){this._searchSmall&&(this._searchSmall=!1,this._showFavourites=!1,this._searchClass=a.expanded,this._favouritesClass=a.contracted,this._showSearches=!0)}},{key:"favouritesClick",value:function(){this._searchSmall||(this._searchSmall=!0,this._searchClass=a.contracted,this._favouritesClass=a.expanded,this._showSearches=!1,this._showFavourites=!0)}}]),b}();b.$inject=[],angular.module("openfin.sidebar").controller("SidebarCtrl",b)}(),function(){angular.module("openfin.sidebar").directive("sideBar",[function(){return{restrict:"E",templateUrl:"sidebars/sidebar.html",controller:"SidebarCtrl",controllerAs:"sidebarCtrl"}}])}(),function(){var a={off:"favourite_OFF",on:"favourite_ON",offHover:"favourite_OFF_hover",onHover:"favourite_hover"},b=function(){function b(a,c){_classCallCheck(this,b),this.$scope=a,this.store=null,this.selectionService=c,this.starHovered=!1,this.check=!1}return _createClass(b,[{key:"favouriteUrl",value:function(b){return b.favourite?a.on:this.starHovered?a.onHover:b.isHovered||this.selectionService.selectedStock()===b?a.offHover:a.off}},{key:"click",value:function(a){(!this.check||confirm("Are you sure you wish to remove this stock ("+a.code+") from your favourites?"))&&(this.store||(this.store=window.storeService.open(window.name)),a.favourite?(a.favourite=!1,this.store.remove(a)):(a.favourite=!0,this.store.add(a)))}},{key:"mouseEnter",value:function(){this.starHovered=!0}},{key:"mouseLeave",value:function(){this.starHovered=!1}}]),b}();b.$inject=["$scope","selectionService"],angular.module("openfin.star").controller("StarCtrl",b)}(),function(){angular.module("openfin.star").directive("star",[function(){return{restrict:"E",templateUrl:"sidebars/star/star.html",scope:{starClick:"&",favouriteUrl:"&",mouseLeave:"&",mouseEnter:"&"}}}])}(),function(){var a="windows",b=["AAPL","MSFT","TITN","SNDK","TSLA"],c=5,d=function(){function b(a,c,d){_classCallCheck(this,b),this.$rootScope=a,this.storage=c,this.store=d}return _createClass(b,[{key:"save",value:function(){localStorage.setItem(a,JSON.stringify(this.storage))}},{key:"update",value:function(a){this.save(),this.$rootScope.$broadcast("updateFavourites",a)}},{key:"get",value:function(){return this.store.stocks}},{key:"reorder",value:function(a,b){if(a!==b){var c=this.store.stocks,d=c.indexOf(a),e=c.indexOf(b);c.splice(e,0,c.splice(d,1)[0]),this.update()}}},{key:"add",value:function(a){var b=a.code;-1===this.store.stocks.indexOf(b)&&(this.store.stocks.push(b),this.update(a))}},{key:"remove",value:function(a){var b=a.code,c=this.store.stocks.indexOf(b);c>-1&&this.store.stocks.splice(c,1),this.update(a)}},{key:"toggleCompact",value:function(a){this.store.compact=a,this.save()}},{key:"isCompact",value:function(){return this.store.compact}},{key:"closeWindow",value:function(){this.store.closed=Date.now(),this.save();var a=this.storage.filter(function(a){return 0!==a.closed});if(a.length>c){a.sort(function(a,b){return b.closed-a.closed});for(var b=c,d=a.length;d>b;b++){var e=this.storage.indexOf(a[b]);this.storage.splice(e,1)}}this.save()}}]),b}(),e=function(){function c(b){_classCallCheck(this,c),this.$rootScope=b,this.storage=JSON.parse(localStorage.getItem(a))}return _createClass(c,[{key:"getPreviousOpenWindowNames",value:function(){return(this.storage||[]).filter(function(a){return 0===a.closed}).map(function(a){return a.id})}},{key:"open",value:function(a){var c,e=(this.storage||[]).map(function(a){return a.id}).indexOf(a);if(e>-1)c=this.storage[e];else{var f=[];this.storage||(f=b,this.storage=[]);var g={id:a,stocks:f,closed:0,compact:!1};this.storage.push(g),c=g}return new d(this.$rootScope,this.storage,c)}}]),c}();e.$inject=["$rootScope"],angular.module("openfin.store").service("storeService",e)}(),function(){var a=function(){function a(b,c){_classCallCheck(this,a),this.$timeout=b,this.currentWindowService=c,this.store=null,this.window=null,this.maximised=!1,this.compact=!1,this.oldSize=null,c.ready(this.onReady.bind(this))}return _createClass(a,[{key:"onReady",value:function(){var a=this;!this.store&&window.storeService&&(this.store=window.storeService.open(window.name)),this.compact=this.store&&this.store.isCompact(),this.window=this.currentWindowService.getCurrentWindow(),this.window.addEventListener("maximized",function(){a.$timeout(function(){a.maximised=!0})}),this.window.addEventListener("restored",function(){a.$timeout(function(){a.maximised=!1})})}},{key:"minimiseClick",value:function(){this.window.minimize()}},{key:"maximiseClick",value:function(){this.window.maximize()}},{key:"normalSizeClick",value:function(){this.window.restore(),this.window.resizeTo(1280,720,"top-right")}},{key:"compactClick",value:function(){var a=this;if(this.store||(this.store=window.storeService.open(window.name)),this.compact=!this.compact,this.compact&&this.window.getBounds(function(b){a.oldSize=[b.width,b.height]}),this.store.toggleCompact(this.compact),window.windowService.updateOptions(this.window,this.compact),this.compact)this.window.resizeTo(230,500,"top-right");else if(this.maximised)this.window.maximize();else{var b=1280,c=720;this.oldSize&&(b=this.oldSize[0],c=this.oldSize[1]),this.window.resizeTo(b,c,"top-right")}}},{key:"closeClick",value:function(){this.window.close()}}]),a}();a.$inject=["$timeout","currentWindowService"],angular.module("openfin.toolbar").controller("ToolbarCtrl",a)}(),function(){angular.module("openfin.toolbar").directive("toolbar",[function(){return{restrict:"E",templateUrl:"toolbar/toolbar.html",controller:"ToolbarCtrl",controllerAs:"toolbarCtrl"}}])}(),function(a){var b=3,c=function(){function c(a,d){_classCallCheck(this,c),this.pool=[],this.$q=a,this.configService=d;for(var e=0;b>e;e++)this._fillPool()}return _createClass(c,[{key:"_fillPool",value:function(){var b=this.$q.defer();this.pool.push({promise:b.promise,window:new a.desktop.Window(this.configService.getWindowConfig(),function(){b.resolve()})})}},{key:"fetch",value:function(){var a=this.pool.shift();return this._fillPool(),a}}]),c}(),d=function(){function a(){_classCallCheck(this,a),this.openWindows={},this.mainWindowsCache=[],this.windowsOpen=0}return _createClass(a,[{key:"add",value:function(a){this.mainWindowsCache.push(a),this.windowsOpen++}},{key:"addTearout",value:function(a,b){this.openWindows[a]?this.openWindows[a].push(b):this.openWindows[a]=[].concat(b)}},{key:"dispose",value:function(a,b){var c=this.openWindows[a.name];c&&c.forEach(function(a){return a.close()}),1!==this.windowsOpen&&b();var d=this.mainWindowsCache.indexOf(a);this.mainWindowsCache.slice(d,1),this.windowsOpen--,0===this.windowsOpen&&window.close()}},{key:"getMainWindows",value:function(){return this.mainWindowsCache}}]),a}(),e=function(){function a(b,c,d,e,f){_classCallCheck(this,a),this.storeService=b,this.geometryService=c,this.windowTracker=d,this.tearoutWindow=e,this.$q=f,this.otherInstance=null}return _createClass(a,[{key:"overAnotherInstance",value:function(a){var b=this,c=this.windowTracker.getMainWindows(),d=!1,e=[];c.forEach(function(a){var c=b.$q.defer();e.push(c.promise),a.getState(function(e){"minimized"!==e&&b.geometryService.windowsIntersect(b.tearoutWindow,a.getNativeWindow())&&(b.otherInstance=a,d=!0),c.resolve()})}),this.$q.all(e).then(function(){return a(d)})}},{key:"moveToOtherInstance",value:function(a){this.storeService.open(this.otherInstance.name).add(a),this.otherInstance.bringToFront()}}]),a}(),f=function(){function b(a,e,f,g){var h=this;_classCallCheck(this,b),this.storeService=a,this.geometryService=e,this.$q=f,this.configService=g,this.windowTracker=new d,this.firstName=!0,this.pool=null,this.ready(function(){h.pool=new c(f,g)})}return _createClass(b,[{key:"createMainWindow",value:function(b,c,d){var e,f=this,g=function(a){a.getNativeWindow().windowService=f,a.getNativeWindow().storeService=f.storeService,f.windowTracker.add(a),d&&d(a),a.show(),a.bringToFront()};if(b)e=new a.desktop.Window(c?this.configService.getCompactConfig(b):this.configService.getWindowConfig(b),function(){g(e)});else{var h=this.pool.fetch();e=h.window,c&&(this.updateOptions(h.window,!0),this.window.resizeTo(230,500,"top-right")),h.promise.then(function(){g(e)})}e.addEventListener("closed",function(a){f.windowTracker.dispose(e,function(){f.storeService.open(e.name).closeWindow()})})}},{key:"createTearoutWindow",value:function(b){var c=new a.desktop.Window(this.configService.getTearoutConfig());return this.windowTracker.addTearout(b,c),c}},{key:"updateOptions",value:function(a,b){b?a.updateOptions({resizable:!1,minHeight:500,minWidth:230,maximizable:!1}):a.updateOptions({resizable:!0,minHeight:510,minWidth:918,maximizable:!0})}},{key:"updateOptions",value:function(a,b){b?a.updateOptions({resizable:!1,minHeight:500,minWidth:230,maximizable:!1}):a.updateOptions({resizable:!0,minHeight:510,minWidth:918,maximizable:!0})}},{key:"ready",value:function(b){a.desktop.main(b)}},{key:"getWindows",value:function(){return this.windowTracker.getMainWindows()}},{key:"registerDrag",value:function(a){return new e(this.storeService,this.geometryService,this.windowTracker,a,this.$q)}}]),b}();f.$inject=["storeService","geometryService","$q","configService"],angular.module("openfin.window").service("windowCreationService",f)}(fin);